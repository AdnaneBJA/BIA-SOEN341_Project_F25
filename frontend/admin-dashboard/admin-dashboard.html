<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../main-page/mainpage.css">
    <link rel="stylesheet" href="admin-dashboard.css">
    <title>Admin Dashboard - BIA</title>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

</head>
<body>
    <nav class="menu-bar">
        <div class="menu-left">
            <span class="menu-logo"><b>BIA</b></span>
        </div>
        <div class="menu-center">
            <a href="../main-page/mainpage.html">Home</a>
            <a href="../event-discovery/event-discovery.html">Events</a>
            <a href="../main-page/tickets.html">Tickets</a>
        </div>
        <div class="menu-right">
            <div class="menu-status">
                <span id="user-status">Admin</span>
                <button id="disconnect-btn" class="disconnect-btn" type="button">Disconnect</button>
            </div>
        </div>
    </nav>

    <main class="center-content hero" style="margin-top:40px; gap:12px;">
        <h1>Admin Dashboard (MOCK page for the moment)</h1>
        <p class="subtitle">Welcome to the admin area. Manage organizers, review events, and view platform analytics.</p>

        <section style="width:90%; max-width:1000px; margin-top:18px;">
            <div style="background:#fff; border-radius:12px; padding:18px; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
                <h2 style="margin-top:0;">Quick Actions</h2>
                <div style="display:flex; gap:12px; flex-wrap:wrap;">
                    <button onclick="location.href='../signup/sign-up-page.html'">Approve Organizer</button>
                    <button onclick="location.href='../organizer-dashboard/organizerdashboard.html'">Moderate Event Listing</button>
                </div>
            </div>

            <div style="background:#fff; border-radius:12px; padding:18px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-top:16px;">
                <h2 style="margin-top:0;">Platform Statistics (hardcoded for the moment)</h2>
                <table style="width:100%; border-collapse:collapse;">
                    <thead>
                        <tr style="text-align:left; border-bottom:2px solid #eaded3;">
                            <th style="padding:8px">Metric</th>
                            <th style="padding:8px">Value</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom:1px solid #f0eaea;">
                            <td style="padding:8px">Total Organizers</td>
                            <td style="padding:8px">12</td>
                        </tr>
                        <tr style="border-bottom:1px solid #f0eaea;">
                            <td style="padding:8px">Active Events</td>
                            <td style="padding:8px">34</td>
                        </tr>
                        <tr>
                            <td style="padding:8px">Tickets Issued</td>
                            <td style="padding:8px">1,248</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div style="background:#fff; border-radius:12px; padding:18px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-top:16px;">
                <h2 style="margin-top:0;">Participation trends</h2>
                <p>[we should have a table or graph containing the participation trends inside this box]</p>
            </div>

            <div class="card" style="margin-top:16px;">
                <h2 style="margin-top:0;">Management</h2>
                <div class="row" style="margin-top:12px;">
                    <button class="admin-btn" onclick="location.href='../organizer-dashboard/organizerdashboard.html'">Overview Organizer Dashboard</button>
                    <!-- additional button below!!!!!!!!-->
                     <button class="admin-btn" id="manage-org-btn">Manage Organizations</button>
                     <button class="admin-btn" id="assign-roles-btn">Assign Roles</button>
                    <button class="admin-btn" onclick="alert('Assign roles UI placeholder')">Assign Roles (maybe delete this)</button>
                </div>
                <!-- addition below !!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
                 <div id="org-root" style="display:none; margin-top:20px;"></div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="footer-inner">
            <span>© <span id="year"></span> BIA Events</span>
            <span class="dot">•</span>
            <a href="../event-discovery/event-discovery.html">Explore Events</a>
        </div>
    </footer>

    <!--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!ORGANIZATION!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-->
  
    <script type="text/babel">
        function AdminOrganizations() {
            const [organizations, setOrganizations] = React.useState([]);
            const [form, setForm] = React.useState({ name: '', description: '' });
            const [message, setMessage] = React.useState('');

            React.useEffect(() => {
                fetch('http://localhost:3000/organizations')
                    .then(res => res.json())
                    .then(data => setOrganizations(data.organizations || []));
            }, []);

            function handleChange(e) {
                setForm({ ...form, [e.target.name]: e.target.value });
            }

            function handleCreate(e) {
                e.preventDefault();
                fetch('http://localhost:3000/organizations', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(form)
                })
                .then(res => res.json())
                .then(data => {
                    if (data.organization) {
                        setOrganizations([...organizations, data.organization]);
                        setMessage('Organization created successfully!');
                        setForm({ name: '', description: '' });
                        setTimeout(() => setMessage(''), 3000); 
                    } else {
                        setMessage('Failed to create organization.');
                    }
                })
                .catch(() => setMessage('Failed to create organization.'));
            }

            function handleDelete(name) {
                fetch(`http://localhost:3000/organizations/${name}`, { method: 'DELETE' })
                    .then(() => setOrganizations(organizations.filter(org => org.name !== name)));
            }
            return (
                <div>
                    <h2>Organizations</h2>
                    {message && <div style={{ color: 'green', marginBottom: '10px' }}>{message}</div>}
                    <form onSubmit={handleCreate}>
                        <input
                            name="name"
                            value={form.name}
                            onChange={handleChange}
                            placeholder="Name"
                            required
                        />
                        <input
                            name="description"
                            value={form.description}
                            onChange={handleChange}
                            placeholder="Description"
                        />
                        <button type="submit">Create</button>
                    </form>
                    <ul style={{ listStyleType: 'none' }}>
                        {organizations.map(org => (
                            <li key={org.id} >
                                {org.name} - {org.description}
                                <button onClick={() => handleDelete(org.name)}>Delete</button>
                            </li>
                        ))}
                    </ul>
                </div>
            );
        }

        
        document.getElementById('manage-org-btn').addEventListener('click', function() {
            const orgRoot = document.getElementById('org-root');
            orgRoot.style.display = 'block';
            ReactDOM.createRoot(orgRoot).render(<AdminOrganizations />);
        });
    </script>

  <!--!!!!!!!!!!!!!!!!!!!!!!!!!!!!!ROLE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!-->
    <script type="text/babel">
        function RoleManager() {
            const [userId, setUserId] = React.useState('');
            const [role, setRole] = React.useState('Student');
            const [message, setMessage] = React.useState('');
            const [messageType, setMessageType] = React.useState(''); 

            async function handleAssign() {
                if (!userId) {
                    setMessageType('error');
                    setMessage('Please enter a user ID.');
                    return;
                }

                const res = await fetch('http://localhost:3000/roles/assign', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId, newRole: role, username: `${userId}`, password: `${userId}`})
                });

                const data = await res.json();
                if (res.ok) {
                    setMessageType('success');
                    setMessage(data.message || 'Role assigned successfully!');
                } else {
                    setMessageType('error');
                    setMessage(data.error || 'Failed to assign role.');
                }

                // Clear message after 5 seconds
                setTimeout(() => setMessage(''), 5000);
            }

            async function handleRevoke() {
                if (!userId) {
                    setMessageType('error');
                    setMessage('Please enter a user ID.');
                    return;
                }

                const res = await fetch(`http://localhost:3000/roles/revoke/${userId}`, {
                    method: 'DELETE'
                });

                const data = await res.json();
                if (res.ok) {
                    setMessageType('success');
                    setMessage(data.message || 'Role revoked successfully!');
                } else {
                    setMessageType('error');
                    setMessage(data.error || 'Failed to revoke role.');
                }

                // Clear message after 5 seconds
                setTimeout(() => setMessage(''), 5000);
            }

            return (
                <div style={{marginTop: '20px'}}>
                    <h2>Assign or Revoke Roles</h2>
                    <input
                        type="number"
                        placeholder="User ID"
                        value={userId}
                        onChange={e => setUserId(e.target.value)}
                        style={{marginRight: '8px'}}
                    />
                    <select value={role} onChange={e => setRole(e.target.value)}>
                        <option value="Student">Student</option>
                        <option value="Organizer">Organizer</option>
                        <option value="Admin">Administrator</option>
                    </select>
                    <div style={{marginTop: '10px'}}>
                        <button onClick={handleAssign}>Assign Role</button>
                        <button onClick={handleRevoke} style={{marginLeft: '10px'}}>Revoke Role</button>
                    </div>

                    {message && (
                        <p
                            style={{
                                marginTop: '10px',
                                color: messageType === 'success' ? 'green' : 'red',
                                fontWeight: 'bold',
                                transition: 'opacity 0.3s ease'
                            }}
                        >
                            {message}
                        </p>
                    )}
                </div>
            );
        }


        
        document.getElementById('assign-roles-btn').addEventListener('click', function() {
            const orgRoot = document.getElementById('org-root');
            orgRoot.style.display = 'block';
            ReactDOM.createRoot(orgRoot).render(<RoleManager />);
        });
    </script>



</body>
</html>
